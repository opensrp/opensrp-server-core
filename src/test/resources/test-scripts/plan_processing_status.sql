-- noinspection SqlDialectInspectionForFile

--clear data
TRUNCATE TABLE core.event CASCADE;

TRUNCATE TABLE core.event_metadata CASCADE;

TRUNCATE TABLE core.plan CASCADE;

TRUNCATE TABLE core.template CASCADE;

TRUNCATE TABLE core.plan_metadata CASCADE;

TRUNCATE TABLE core.plan_processing_status CASCADE;

ALTER SEQUENCE core.plan_processing_status_id_seq RESTART WITH 6;

--insert data
INSERT INTO core.event (id, json, date_deleted) VALUES
(1, '{"_id": "fa2242d1-cf34-454a-8c06-7bd55e408044", "obs": [{"values": ["2018-03-14"], "fieldCode": "1410AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA", "fieldType": "concept", "parentCode": "36AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA", "fieldDataType": "date", "formSubmissionField": "measles_1", "humanReadableValues": []}, {"values": ["1"], "fieldCode": "1418AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA", "fieldType": "concept", "parentCode": "36AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA", "fieldDataType": "calculate", "formSubmissionField": "measles_1_dose", "humanReadableValues": []}], "type": "Event", "version": 1521033238310, "duration": 0, "_rev": "1-dff06b7575a5177c7200b08570d14f4b", "eventDate": "2018-03-14T19:09:51.379+03:00", "eventType": "Vaccination", "entityType": "vaccination", "locationId": "42b88545-7ebb-4e11-8d1a-3d3a924c8af4", "providerId": "biddemo", "dateCreated": "2018-03-19T17:27:28.750+03:00", "identifiers": {}, "baseEntityId": "ea1f9439-a663-4073-93b9-6ef2b8bca3c1", "serverVersion": 1521033533700, "formSubmissionId": "bfbfabe8-d4ae-4db2-940f-a6f126ef7829"}', null),
(2, '{"_id": "1c3f6eac-a765-4423-bbda-c01ed6430ae8", "obs": [], "_rev": "v1", "type": "Event", "teamId": " ", "details": {"id": "3761", "age": "69", "bfid": "1206030008", "flag": "Source", "species": "M", "surname": "QA Test", "focus_id": "95cf7e39-fd03-41f9-be02-a33e9a738f78", "first_name": "Madrine", "focus_name": "เมืองทอง(Source)-4", "case_number": "2401224081141261323", "family_name": "Madrine", "focus_reason": "Investigation", "focus_status": "A2", "house_number": "H321", "planIdentifier": "508f25e6-ad9c-40a7-8147-a5315499e9ab", "ep1_create_date": "2021-12-07T00:00:00.000+0000", "ep3_create_date": "2021-12-07T00:00:00.000+0000", "investigtion_date": "2021-12-07T00:00:00.000+0000", "case_classification": "Bz"}, "version": 1557860282617, "duration": 0, "eventDate": "2021-12-07T00:00:00.000Z", "eventType": "Case_Details", "entityType": "Case_Details", "locationId": "95cf7e39-fd03-41f9-be02-a33e9a738f78", "providerId": "nifi-user", "dateCreated": "2021-12-07T10:14:19.154Z", "identifiers": {}, "baseEntityId": "95cf7e39-fd03-41f9-be02-a33e9a738f78", "serverVersion": 1607066372487, "formSubmissionId": "c95dfcfb-63bf-485e-b623-c711f38dc15b"}' ,null);


INSERT INTO core.event_metadata (id, event_id, document_id, base_entity_id, form_submission_id, server_version, openmrs_uuid, event_type, event_date, entity_type ,provider_id, location_id, team, team_id, date_created, date_edited, date_deleted) VALUES
(1, 1, 'fa2242d1-cf34-454a-8c06-7bd55e408044', 'ea1f9439-a663-4073-93b9-6ef2b8bca3c1', 'bfbfabe8-d4ae-4db2-940f-a6f126ef7829', 1521033533700, null, 'Vaccination', '2018-03-14 19:09:51.379000', 'vaccination', 'biddemo', '42b88545-7ebb-4e11-8d1a-3d3a924c8af4', null, null, '2018-03-19 17:27:28.750000', null, null),
(2, 2, '1c3f6eac-a765-4423-bbda-c01ed6430ae8', '95cf7e39-fd03-41f9-be02-a33e9a738f78', '95cf7e39-fd03-41f9-be02-a33e9a738f78', 1521033533701, null, 'Case_Details', '2018-03-14 19:09:51.379000', 'location', 'biddemo', '42b88545-7ebb-4e11-8d1a-3d3a924c8af4', null, null, '2018-03-19 17:27:28.750000', null, null);

INSERT INTO core.plan (id, identifier, json, date_deleted,server_version) VALUES
(1, '362565f0-573b-11ec-bf63-0242ac130002','{"date": "2019-11-01", "goal": [{"id": "Case_Confirmation", "target": [{"due": "2019-11-08", "detail": {"detailQuantity": {"unit": "case(s)", "value": 1.0, "comparator": ">="}}, "measure": "Number of cases confirmed"}], "priority": "medium-priority", "description": "Confirm the index case"}, {"id": "RACD_register_families", "target": [{"due": "2019-11-08", "detail": {"detailQuantity": {"unit": "Percent", "value": 100.0, "comparator": ">="}}, "measure": "Percent of residential structures with full family registration"}], "priority": "medium-priority", "description": "Register all families & family members in all residential structures enumerated (100%) within the operational area"}, {"id": "RACD_Blood_Screening", "target": [{"due": "2019-11-08", "detail": {"detailQuantity": {"unit": "Person(s)", "value": 100.0, "comparator": ">="}}, "measure": "Number of registered people tested"}], "priority": "medium-priority", "description": "Visit all residential structures (100%) within a 1 km radius of a confirmed index case and test each registered person"}, {"id": "RACD_bednet_distribution", "target": [{"due": "2019-11-08", "detail": {"detailQuantity": {"unit": "Percent", "value": 100.0, "comparator": ">="}}, "measure": "Percent of residential structures received nets"}], "priority": "medium-priority", "description": "Visit 100% of residential structures in the operational area and provide nets"}, {"id": "Larval_Dipping", "target": [{"due": "2019-11-08", "detail": {"detailQuantity": {"unit": "activit(y|ies)", "value": 3.0, "comparator": ">="}}, "measure": "Number of larval dipping activities completed"}], "priority": "medium-priority", "description": "Perform a minimum of three larval dipping activities in the operational area"}, {"id": "Mosquito_Collection", "target": [{"due": "2019-11-08", "detail": {"detailQuantity": {"unit": "activit(y|ies)", "value": 3.0, "comparator": ">="}}, "measure": "Number of mosquito collection activities completed"}], "priority": "medium-priority", "description": "Set a minimum of three mosquito collection traps and complete the mosquito collection process"}, {"id": "BCC_Focus", "target": [{"due": "2019-11-08", "detail": {"detailQuantity": {"unit": "activit(y|ies)", "value": 1.0, "comparator": ">="}}, "measure": "Number of BCC Activities Completed"}], "priority": "medium-priority", "description": "Complete at least 1 BCC activity for the operational area"}], "name": "A1-Akros_1-2019-11-01", "title": "local A1 Akros_1 2019-11-01 test", "action": [{"code": "Case Confirmation", "title": "Case Confirmation", "goalId": "Case_Confirmation", "prefix": 1, "reason": "Investigation", "identifier": "ae158ee0-dbd1-5eb9-ae4b-cc3f1f7805fc", "description": "Confirm the index case", "taskTemplate": "Case_Confirmation", "timingPeriod": {"end": "2020-02-29", "start": "2019-11-01"}, "subjectCodableConcept": {"text": "Operational_Area"}}, {"code": "RACD Register Family", "title": "Family Registration", "goalId": "RACD_register_families", "prefix": 2, "reason": "Investigation", "identifier": "44e76d66-66a8-5d85-9ac9-53eae86888be", "description": "Register all families & family members in all residential structures enumerated (100%) within the operational area", "taskTemplate": "RACD_register_families", "timingPeriod": {"end": "2019-11-08", "start": "2019-11-01"}, "subjectCodableConcept": {"text": "Residential_Structure"}}, {"code": "Blood Screening", "title": "Blood screening", "goalId": "RACD_Blood_Screening", "prefix": 3, "reason": "Investigation", "identifier": "4ae8c881-cbda-5a48-b168-2b2bb44d018a", "description": "Visit all residential structures (100%) within a 1 km radius of a confirmed index case and test each registered person", "taskTemplate": "RACD_Blood_Screening", "timingPeriod": {"end": "2019-11-08", "start": "2019-11-01"}, "subjectCodableConcept": {"text": "Person"}}, {"code": "Bednet Distribution", "title": "Bednet Distribution", "goalId": "RACD_bednet_distribution", "prefix": 4, "reason": "Investigation", "identifier": "af35739d-c24c-509d-b102-8eece714980d", "description": "Visit 100% of residential structures in the operational area and provide nets", "taskTemplate": "Bednet_Distribution", "timingPeriod": {"end": "2019-11-08", "start": "2019-11-01"}, "subjectCodableConcept": {"text": "Residential_Structure"}}, {"code": "Larval Dipping", "title": "Larval Dipping", "goalId": "Larval_Dipping", "prefix": 5, "reason": "Investigation", "identifier": "2dacc2db-66c4-50e4-a2a9-0f65a03ed0e1", "description": "Perform a minimum of three larval dipping activities in the operational area", "taskTemplate": "Larval_Dipping", "timingPeriod": {"end": "2019-11-08", "start": "2019-11-01"}, "subjectCodableConcept": {"text": "Breeding_Site"}}, {"code": "Mosquito Collection", "title": "Mosquito Collection", "goalId": "Mosquito_Collection", "prefix": 6, "reason": "Investigation", "identifier": "a1757995-4911-54f5-8086-e8d0d133d3e2", "description": "Set a minimum of three mosquito collection traps and complete the mosquito collection process", "taskTemplate": "Mosquito_Collection_Point", "timingPeriod": {"end": "2019-11-08", "start": "2019-11-01"}, "subjectCodableConcept": {"text": "Mosquito_Collection_Point"}}, {"code": "BCC", "title": "Behaviour Change Communication", "goalId": "BCC_Focus", "prefix": 7, "reason": "Investigation", "identifier": "ac04a71e-7a11-552f-91f0-4e8509e75db2", "description": "Conduct BCC activity", "taskTemplate": "BCC_Focus", "timingPeriod": {"end": "2019-11-08", "start": "2019-11-01"}, "subjectCodableConcept": {"text": "Operational_Area"}}], "status": "active", "version": "3", "identifier": "a8b3010c-1ba5-556d-8b16-71266397b8b9", "useContext": [{"code": "interventionType", "valueCodableConcept": "FI"}, {"code": "fiStatus", "valueCodableConcept": "A1"}, {"code": "fiReason", "valueCodableConcept": "Routine"}, {"code": "taskGenerationStatus", "valueCodableConcept": "True"}], "jurisdiction": [{"code": "3951"}, {"code": "3952"}], "serverVersion": 1582200627471, "effectivePeriod": {"end": "2020-04-21", "start": "2019-11-01"}}', null,0),
(2, '3450034c-1ba5-556d-8b16-71266397b8b9','{"date": "2019-11-01", "goal": [{"id": "Case_Confirmation", "target": [{"due": "2019-11-08", "detail": {"detailQuantity": {"unit": "case(s)", "value": 1.0, "comparator": ">="}}, "measure": "Number of cases confirmed"}], "priority": "medium-priority", "description": "Confirm the index case"}, {"id": "RACD_register_families", "target": [{"due": "2019-11-08", "detail": {"detailQuantity": {"unit": "Percent", "value": 100.0, "comparator": ">="}}, "measure": "Percent of residential structures with full family registration"}], "priority": "medium-priority", "description": "Register all families & family members in all residential structures enumerated (100%) within the operational area"}, {"id": "RACD_Blood_Screening", "target": [{"due": "2019-11-08", "detail": {"detailQuantity": {"unit": "Person(s)", "value": 100.0, "comparator": ">="}}, "measure": "Number of registered people tested"}], "priority": "medium-priority", "description": "Visit all residential structures (100%) within a 1 km radius of a confirmed index case and test each registered person"}, {"id": "RACD_bednet_distribution", "target": [{"due": "2019-11-08", "detail": {"detailQuantity": {"unit": "Percent", "value": 100.0, "comparator": ">="}}, "measure": "Percent of residential structures received nets"}], "priority": "medium-priority", "description": "Visit 100% of residential structures in the operational area and provide nets"}, {"id": "Larval_Dipping", "target": [{"due": "2019-11-08", "detail": {"detailQuantity": {"unit": "activit(y|ies)", "value": 3.0, "comparator": ">="}}, "measure": "Number of larval dipping activities completed"}], "priority": "medium-priority", "description": "Perform a minimum of three larval dipping activities in the operational area"}, {"id": "Mosquito_Collection", "target": [{"due": "2019-11-08", "detail": {"detailQuantity": {"unit": "activit(y|ies)", "value": 3.0, "comparator": ">="}}, "measure": "Number of mosquito collection activities completed"}], "priority": "medium-priority", "description": "Set a minimum of three mosquito collection traps and complete the mosquito collection process"}, {"id": "BCC_Focus", "target": [{"due": "2019-11-08", "detail": {"detailQuantity": {"unit": "activit(y|ies)", "value": 1.0, "comparator": ">="}}, "measure": "Number of BCC Activities Completed"}], "priority": "medium-priority", "description": "Complete at least 1 BCC activity for the operational area"}], "name": "A1-Akros_1-2019-11-01", "title": "local A1 Akros_1 2019-11-01 test", "action": [{"code": "Case Confirmation", "title": "Case Confirmation", "goalId": "Case_Confirmation", "prefix": 1, "reason": "Investigation", "identifier": "ae158ee0-dbd1-5eb9-ae4b-cc3f1f7805fc", "description": "Confirm the index case", "taskTemplate": "Case_Confirmation", "timingPeriod": {"end": "2020-02-29", "start": "2019-11-01"}, "subjectCodableConcept": {"text": "Operational_Area"}}, {"code": "RACD Register Family", "title": "Family Registration", "goalId": "RACD_register_families", "prefix": 2, "reason": "Investigation", "identifier": "44e76d66-66a8-5d85-9ac9-53eae86888be", "description": "Register all families & family members in all residential structures enumerated (100%) within the operational area", "taskTemplate": "RACD_register_families", "timingPeriod": {"end": "2019-11-08", "start": "2019-11-01"}, "subjectCodableConcept": {"text": "Residential_Structure"}}, {"code": "Blood Screening", "title": "Blood screening", "goalId": "RACD_Blood_Screening", "prefix": 3, "reason": "Investigation", "identifier": "4ae8c881-cbda-5a48-b168-2b2bb44d018a", "description": "Visit all residential structures (100%) within a 1 km radius of a confirmed index case and test each registered person", "taskTemplate": "RACD_Blood_Screening", "timingPeriod": {"end": "2019-11-08", "start": "2019-11-01"}, "subjectCodableConcept": {"text": "Person"}}, {"code": "Bednet Distribution", "title": "Bednet Distribution", "goalId": "RACD_bednet_distribution", "prefix": 4, "reason": "Investigation", "identifier": "af35739d-c24c-509d-b102-8eece714980d", "description": "Visit 100% of residential structures in the operational area and provide nets", "taskTemplate": "Bednet_Distribution", "timingPeriod": {"end": "2019-11-08", "start": "2019-11-01"}, "subjectCodableConcept": {"text": "Residential_Structure"}}, {"code": "Larval Dipping", "title": "Larval Dipping", "goalId": "Larval_Dipping", "prefix": 5, "reason": "Investigation", "identifier": "2dacc2db-66c4-50e4-a2a9-0f65a03ed0e1", "description": "Perform a minimum of three larval dipping activities in the operational area", "taskTemplate": "Larval_Dipping", "timingPeriod": {"end": "2019-11-08", "start": "2019-11-01"}, "subjectCodableConcept": {"text": "Breeding_Site"}}, {"code": "Mosquito Collection", "title": "Mosquito Collection", "goalId": "Mosquito_Collection", "prefix": 6, "reason": "Investigation", "identifier": "a1757995-4911-54f5-8086-e8d0d133d3e2", "description": "Set a minimum of three mosquito collection traps and complete the mosquito collection process", "taskTemplate": "Mosquito_Collection_Point", "timingPeriod": {"end": "2019-11-08", "start": "2019-11-01"}, "subjectCodableConcept": {"text": "Mosquito_Collection_Point"}}, {"code": "BCC", "title": "Behaviour Change Communication", "goalId": "BCC_Focus", "prefix": 7, "reason": "Investigation", "identifier": "ac04a71e-7a11-552f-91f0-4e8509e75db2", "description": "Conduct BCC activity", "taskTemplate": "BCC_Focus", "timingPeriod": {"end": "2019-11-08", "start": "2019-11-01"}, "subjectCodableConcept": {"text": "Operational_Area"}}], "status": "active", "version": "3", "identifier": "a8b3010c-1ba5-556d-8b16-71266397b8b9", "useContext": [{"code": "interventionType", "valueCodableConcept": "FI"}, {"code": "fiStatus", "valueCodableConcept": "A1"}, {"code": "fiReason", "valueCodableConcept": "Routine"}, {"code": "taskGenerationStatus", "valueCodableConcept": "True"}], "jurisdiction": [{"code": "3951"}, {"code": "3952"}], "serverVersion": 1582200627471, "effectivePeriod": {"end": "2020-04-21", "start": "2019-11-01"}}', null,1);


INSERT INTO core.plan_metadata (operational_area_id,identifier, plan_id) VALUES
('3735','d8b81146-5740-11ec-bf63-0242ac130002',1),
('3735','3450034c-1ba5-556d-8b16-71266397b8b9',2);

INSERT INTO core.template (id,template_id, template, type)
VALUES (1, 1, '{"date": "${currentDate}", "goal": [{"id": "Case_Confirmation", "target": [{"due": "${endDate}", "detail": {"detailQuantity": {"unit": "case(s)", "value": 1.0, "comparator": "&amp;gt;="}}, "measure": "จำนวนผู้ป่วยที่ได้รับการยืนยัน"}], "priority": "medium-priority", "description": "ยืนยันบ้านผู้ป่วย"}, {"id": "RACD_register_families", "target": [{"due": "${endDate}", "detail": {"detailQuantity": {"unit": "%", "value": 100.0, "comparator": "&gt;="}}, "measure": "ร้อยละของบ้าน สิ่งปลูกสร้างที่ได้ลงทะเบียนข้อมูลครัวเรือน"}], "priority": "medium-priority", "description": "ลงทะเบียนครัวเรือนและสมาชิกในครัวเรือน (100%) ภายในพื้นที่ปฏิบัติงาน"}, {"id": "RACD_Blood_Screening", "target": [{"due": "${endDate}", "detail": {"detailQuantity": {"unit": "คน", "value": 50.0, "comparator": "&gt;="}}, "measure": "จำนวนผู้ที่ได้รับการเจาะโลหิต"}], "priority": "medium-priority", "description": "เจาะเลือดรอบบ้านผู้ป่วยในรัศมี 1 กิโลเมตร (100%)"}, {"id": "BCC_Focus", "target": [{"due": "${endDate}", "detail": {"detailQuantity": {"unit": "แห่ง", "value": 1.0, "comparator": "&gt;="}}, "measure": "จำนวนกิจกรรมการให้สุขศึกษา"}], "priority": "medium-priority", "description": "ให้สุขศึกษาในพื้นที่ปฏิบัติงานอย่างน้อย 1 ครั้ง"}, {"id": "RACD_bednet_distribution", "target": [{"due": "${endDate}", "detail": {"detailQuantity": {"unit": "%", "value": 90.0, "comparator": "&gt;="}}, "measure": "จำนวนบ้าน/สิ่งปลูกสร้างที่ได้รับมุ้ง"}], "priority": "medium-priority", "description": "แจกมุ้งทุกหลังคาเรือนในพื้นที่ปฏิบัติงาน (100%)"}, {"id": "Larval_Dipping", "target": [{"due": "${endDate}", "detail": {"detailQuantity": {"unit": "แห่ง", "value": 3.0, "comparator": "&gt;="}}, "measure": "จำนวนกิจกรรมการตักลูกน้ำ"}], "priority": "medium-priority", "description": "ดำเนินกิจกรรมจับลูกน้ำอย่างน้อย 3 แห่งในพื้นที่ปฏิบัติงาน"}, {"id": "Mosquito_Collection", "target": [{"due": "${endDate}", "detail": {"detailQuantity": {"unit": "แห่ง", "value": 3.0, "comparator": "&gt;="}}, "measure": "จำนวนกิจกรรมการจับยุง"}], "priority": "medium-priority", "description": "กิจกรรมจับยุงกำหนดไว้อย่างน้อย 3 แห่ง"}], "name": "${focus_status}-${focus_name}-${patient_name}_${patient_surname}-${currentDate}-${flag}", "title": "${focus_status} - ${focus_name} - ${patient_name} ${patient_surname} - ${currentDate} - ${flag}", "action": [{"code": "Case Confirmation", "type": "create", "title": "การยืนยันบ้านผู้ป่วย", "goalId": "Case_Confirmation", "prefix": 1, "reason": "Investigation", "trigger": [{"name": "plan-activation", "type": "named-event"}], "condition": [{"kind": "applicability", "expression": {"expression": "questionnaire = Case_Details", "description": "Event is case details event"}}], "identifier": "662d4bff-43cc-4f50-af1e-3bc86f8af253", "description": "ยืนยันบ้านผู้ป่วย", "timingPeriod": {"end": "2021-09-23", "start": "2021-09-13"}, "definitionUri": "case_confirmation.json", "subjectCodableConcept": {"text": "Jurisdiction"}}, {"code": "RACD Register Family", "type": "create", "title": "ลงทะเบียนครัวเรือน", "goalId": "RACD_register_families", "prefix": 2, "reason": "Investigation", "trigger": [{"name": "plan-activation", "type": "named-event"}, {"name": "event-submission", "type": "named-event", "expression": {"expression": "questionnaire = Register_Structure or questionnaire = Archive_Family", "description": "Trigger when a Register_Structure event is submitted"}}], "condition": [{"kind": "applicability", "expression": {"expression": "$this.is(FHIR.Location) or (questionnaire = Register_Structure and $this.item.where(linkId=structureType).answer.value =Residential Structure)", "description": "Apply to residential structures in Register_Structure questionnaires"}}, {"kind": "applicability", "expression": {"expression": "$this.is(FHIR.QuestionnaireResponse) or (($this.type.where(id=locationType).exists().not() or $this.type.where(id=locationType).text = Residential Structure) and $this.contained.exists().not())", "description": "Structure is residential or type does not exist", "subjectCodableConcept": {"text": "Family"}}}], "identifier": "${registerFamilyActionId}", "description": "ลงทะเบียนครัวเรือนและสมาชิกในครัวเรือน (100%) ภายในพื้นที่ปฏิบัติงาน", "timingPeriod": {"end": "${endDate}", "start": "${currentDate}"}, "definitionUri": "family_register.json", "subjectCodableConcept": {"text": "Location"}}, {"code": "Blood Screening", "type": "create", "title": "กิจกรรมการเจาะโลหิต", "goalId": "RACD_Blood_Screening", "prefix": 3, "reason": "Investigation", "trigger": [{"name": "plan-activation", "type": "named-event"}, {"name": "event-submission", "type": "named-event", "expression": {"expression": "questionnaire = Family_Registration or questionnaire = Family_Member_Registration", "description": "Trigger when a Family Registration or Family Member Registration event is submitted"}}], "condition": [{"kind": "applicability", "expression": {"expression": "($this.is(FHIR.Patient) and $this.birthDate &lt;= today() - 5 years) or ($this.contained.where(Patient.birthDate &lt;= today() - 5 years).exists())", "description": "Person is older than 5 years or person associated with questionnaire response if older than 5 years"}}], "identifier": "${bloodScreeningActionId}", "description": "เจาะเลือดรอบบ้านผู้ป่วยในรัศมี 1 กิโลเมตร (100%)", "timingPeriod": {"end": "${endDate}", "start": "${currentDate}"}, "definitionUri": "blood_screening.json", "subjectCodableConcept": {"text": "Person"}}, {"code": "BCC", "type": "create", "title": "กิจกรรมการให้สุขศึกษา", "goalId": "BCC_Focus", "prefix": 4, "reason": "Investigation", "trigger": [{"name": "plan-activation", "type": "named-event"}], "condition": [{"kind": "applicability", "expression": {"expression": "Location.physicalType.coding.exists(code=jdn)", "description": "Jurisdiction type location"}}], "identifier": "${bccActionId}", "description": "ดำเนินกิจกรรมให้สุขศึกษา", "timingPeriod": {"end": "${endDate}", "start": "${currentDate}"}, "definitionUri": "behaviour_change_communication.json", "subjectCodableConcept": {"text": "Jurisdiction"}}, {"code": "Bednet Distribution", "type": "create", "title": "กิจกรรมสำรวจ/ชุบ/แจกมุ้ง", "goalId": "RACD_bednet_distribution", "prefix": 5, "reason": "Investigation", "trigger": [{"name": "plan-activation", "type": "named-event"}, {"name": "event-submission", "type": "named-event", "expression": {"expression": "questionnaire = Family_Registration", "description": "Trigger when a Family Registration event is submitted"}}], "condition": [{"kind": "applicability", "expression": {"expression": "$this.is(FHIR.QuestionnaireResponse) or (($this.type.where(id=locationType).exists().not() or $this.type.where(id=locationType).text = Residential Structure) and $this.contained.exists())", "description": "Structure is residential or type does not exist", "subjectCodableConcept": {"text": "Family"}}}], "identifier": "${bednetDistributionActionId}", "description": "แจกมุ้งทุกหลังคาเรือนในพื้นที่ปฏิบัติงาน (100%)", "timingPeriod": {"end": "${endDate}", "start": "${currentDate}"}, "definitionUri": "bednet_distribution.json", "subjectCodableConcept": {"text": "Location"}}, {"code": "Larval Dipping", "type": "create", "title": "กิจกรรมการตักลูกน้ำ", "goalId": "Larval_Dipping", "prefix": 6, "reason": "Investigation", "trigger": [{"name": "event-submission", "type": "named-event", "expression": {"expression": "questionnaire = Register_Structure", "description": "Trigger when a Register_Structure event is submitted"}}, {"name": "plan-activation", "type": "named-event"}], "condition": [{"kind": "applicability", "expression": {"expression": "$this.is(FHIR.Location) or (questionnaire = Register_Structure and $this.item.where(linkId=structureType).answer.value =Larval Breeding Site)", "description": "Apply to larval breeding sites in Register_Structure questionnaires"}}, {"kind": "applicability", "expression": {"expression": "$this.is(FHIR.QuestionnaireResponse) or $this.type.where(id=locationType).text = Larval Breeding Site", "description": "Structure is a larval breeding site"}}], "identifier": "${larvalDippingActionId}", "description": "ดำเนินกิจกรรมจับลูกน้ำอย่างน้อย 3 แห่งในพื้นที่ปฏิบัติงาน", "timingPeriod": {"end": "${endDate}", "start": "${currentDate}"}, "definitionUri": "larval_dipping_form.json", "subjectCodableConcept": {"text": "Location"}}, {"code": "Mosquito Collection", "type": "create", "title": "กิจกรรมการจับยุง", "goalId": "Mosquito_Collection", "prefix": 7, "reason": "Investigation", "trigger": [{"name": "plan-activation", "type": "named-event"}, {"name": "event-submission", "type": "named-event", "expression": {"expression": "questionnaire = Register_Structure", "description": "Trigger when a Register_Structure event is submitted"}}], "condition": [{"kind": "applicability", "expression": {"expression": "$this.is(FHIR.QuestionnaireResponse) or $this.type.where(id=locationType).text = Mosquito Collection Point", "description": "Structure is a mosquito collection point"}}, {"kind": "applicability", "expression": {"expression": "$this.is(FHIR.Location) or (questionnaire = Register_Structure and $this.item.where(linkId=structureType).answer.value =Mosquito Collection Point)", "description": "Apply to mosquito collection point in Register_Structure questionnaires"}}], "identifier": "${mosquitoCollectionActionId}", "description": "กิจกรรมจับยุงกำหนดไว้อย่างน้อย 3 แห่ง", "timingPeriod": {"end": "${endDate}", "start": "${currentDate}"}, "definitionUri": "mosquito_collection_form.json", "subjectCodableConcept": {"text": "Location"}}], "status": "draft", "version": "1", "identifier": "${planIdentifier}", "useContext": [{"code": "interventionType", "valueCodableConcept": "Dynamic-FI"}, {"code": "fiStatus", "valueCodableConcept": "${focus_status}"}, {"code": "fiReason", "valueCodableConcept": "Case Triggered"}, {"code": "opensrpEventId", "valueCodableConcept": "${opensrpCaseClassificationEventId}"}, {"code": "caseNum", "valueCodableConcept": "${case_number}"}, {"code": "taskGenerationStatus", "valueCodableConcept": "internal"}], "experimental": false, "jurisdiction": [{"code": "${focus_id}"}], "serverVersion": 0, "effectivePeriod": {"end": "${endDate}", "start": "${currentDate}"}}' , 'plan');


INSERT INTO core.plan_processing_status (id,plan_id, event_id, template_id, status)
VALUES (1,1,1,1,0);
